<!doctype HTML>
<html>

<head>
    <script src="script.js"></script>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/jeromeetienne/AR.js/2.0.5/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/whatwg-fetch@3.6.2/dist/fetch.umd.min.js"></script>
</head>

<body style="margin : 0px; overflow: scroll;">
    <div class="ui-container">
        <label for="findOrgan">Ведите выбранный орган: </label>
        <input type="text" id="findOrgan" placeholder="Введите запрос">
        <button onclick="findOrgan()">Найти орган</button>
        
        <button id="openDialog">Инструкция</button>
        <dialog>
            <p>Наведите камеру на маркер. Перед вами повится модель человека.</p>
            <p>Введите в поисковую строку орган, о котором хотите узнать информацию.</p>
            <p>Сейчас доступны следующие органы:</p>
            <ul>
              <li>Сердце</li>
              <li>Желудок</li>
              <li>Мозг</li>
              <li>Кишечник</li>
              <li>Печень</li>
              <li>Лёгкие</li>
            </ul>
            <p><button id="closeDialog">Закрыть окно</button></p>
        </dialog>
    </div>
    <div id="organInfo" style="display: none;">
      <div class="organ-header">
        <h4 id="organName"></h4>
        <img id="organImage" alt="Organ image" style="width: 25%; height: 30%; object-fit: cover; display: none;">
      </div>
      <p id="organDescription" style="margin-top: 12px;"></p>
    </div>
  
    <script>
        var dialog = document.querySelector('dialog');
        document.querySelector('#openDialog').onclick = function () {
            dialog.show(); // Показываем диалоговое окно
        }
        document.querySelector('#closeDialog').onclick = function () {
            dialog.close(); // Прячем диалоговое окно
        }
    </script>

    <a-scene embedded arjs="debugUIEnabled: false;">
        <a-marker type="pattern"
            url="https://cdn.glitch.global/8ff89136-0b2a-4a88-b122-314e4792710a/%D0%9C%D0%B0%D1%80%D0%BA%D0%B5%D1%80.patt?v=1734254835291">

            <!-- Добавляем модели на сцену -->
            <a-entity id="myModel"
                gltf-model="https://cdn.glitch.global/8ff89136-0b2a-4a88-b122-314e4792710a/%D0%B0%D0%B2%D0%B0%D1%82%D0%B0%D1%80.glb?v=1734201338326"
                scale="0.5 0.5 0.5" position="0 0 0" rotation="0 0 0"
                material="opacity: 0.5; transparent: true;emissive: #ff0000; emissive-intensity: 1">
            </a-entity>

            <a-entity id="heart"
                gltf-model="https://cdn.glitch.global/8ff89136-0b2a-4a88-b122-314e4792710a/%D1%81%D0%B5%D1%80%D0%B4%D1%86%D0%B5%202.glb?v=1734203726884"
                scale="0.08 0.08 0.08" position="-0.05 2.8 0.00789" rotation="10 -90 0">
            </a-entity>

            <a-entity id="liver"
                gltf-model="https://cdn.glitch.global/8ff89136-0b2a-4a88-b122-314e4792710a/render%20(34).glb?v=1733693256101"
                scale="0.15 0.15 0.15" position="-0.125 2.64 0.08" rotation="1 0 -12">
            </a-entity>

            <a-entity id="brain"
                gltf-model="https://cdn.glitch.global/8ff89136-0b2a-4a88-b122-314e4792710a/%D0%BC%D0%BE%D0%B7%D0%B3%20-1.glb?v=1734205977399"
                scale="0.141 0.141 0.141" position="-0.1 3.85 0.05" rotation="0 -11 -0.05">
            </a-entity>

            <a-entity id="lungs"
                gltf-model="https://cdn.glitch.global/8ff89136-0b2a-4a88-b122-314e4792710a/%D0%BB%D0%B5%D0%B3%D0%BA%D0%B8%D0%B5.glb?v=1734202777285"
                scale="0.18 0.18 0.18" position="0 2.78 -0.0025" rotation="0 0 0">
            </a-entity>

            <a-entity 
              id="intestine"
              gltf-model="https://cdn.glitch.global/8ff89136-0b2a-4a88-b122-314e4792710a/%D0%9A%D0%B8%D1%88%D0%B5%D1%87%D0%BD%D0%B8%D0%BA12.glb?v=1734258391385"
              scale="0.16 0.16 0.16"
              position="-0.04 1.45 -0.054" 
              rotation="0 -90 0">
            </a-entity>

            <a-entity 
              id="stomach"
              gltf-model="https://cdn.glitch.global/8ff89136-0b2a-4a88-b122-314e4792710a/%D0%96%D0%B5%D0%BB%D1%83%D0%B4%D0%BE%D0%BA.glb?v=1734258354688"
              scale="0.08 0.08 0.08"
              position="0.08 2.5 0.09" 
              rotation="0 -90 0">
            </a-entity>

        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>

<!--  Добавляем текстуры  -->
    <script>

        const textureLoader = new THREE.TextureLoader();
        const model = document.querySelector('#myModel');
        const heart = document.querySelector('#heart');
        const lungs = document.querySelector('#lungs');

        model.addEventListener('model-loaded', () => {
            const object3D = model.object3D;
            object3D.traverse((node) => {
                if (node.isMesh) {
                    const modelTexture = textureLoader.load("https://cdn.glitch.global/8ff89136-0b2a-4a88-b122-314e4792710a/%D0%9A%D0%BE%D0%B6%D0%B0.jpg?v=1734205193055");
                    node.material.map = modelTexture;
                    node.material.transparent = true;
                    node.material.opacity = 0.8;
                    node.material.needsUpdate = true;
                }
            });
        });

        heart.addEventListener('model-loaded', () => {
            const object3D = heart.object3D;
            object3D.traverse((node) => {
                if (node.isMesh) {
                    const heartTexture = textureLoader.load("https://cdn.glitch.global/8ff89136-0b2a-4a88-b122-314e4792710a/%D0%A2%D0%B5%D0%BA%D1%81%D1%82%D1%83%D1%80%D0%B0%D0%A1%D0%B5%D1%80%D0%B4%D1%86%D0%B0.jpg?v=1734203858719");

                    node.material.map = heartTexture;
                    node.material.needsUpdate = true;
                }
            });
        });

        lungs.addEventListener('model-loaded', () => {
            const object3D = lungs.object3D;
            object3D.traverse((node) => {
                if (node.isMesh) {
                    const lungsTexture = textureLoader.load("https://cdn.glitch.global/8ff89136-0b2a-4a88-b122-314e4792710a/%D0%9B%D0%B5%D0%B3%D0%BA%D0%B8%D0%B5%D0%A2%D0%B5%D0%BA%D1%81%D1%82%D1%83%D1%80%D0%B0.jpg?v=1734206246590");
                    node.material.map = lungsTexture;
                    node.material.needsUpdate = true;
                }
            });
        });

    </script>

</body>

</html>